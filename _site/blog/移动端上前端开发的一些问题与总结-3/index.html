<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN" class="js">
<!--<![endif]-->
  

	

	
<head>
	<meta charset="utf-8">
	<title>移动端上前端开发的一些问题与总结（3） | Cyan的技术笔记</title>
	<meta name="description" content="  前端 , html5, 移动开发, 关于ios系统中，webapp启动图片在不同设备上的适应性设置">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">
	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel='stylesheet' id='divi-style-css'  href="/css/style.css" type='text/css' media='all' />
	<link rel="stylesheet" href="/css/post.style.css">

	<script type='text/javascript' src="/js/jquery.js"></script>
	<script type='text/javascript' src="/js/soundmanager2-nodebug-jsmin.js"></script>

	<!--Favicon-->
	<link rel="icon" href="favicon.ico" type="image/x-icon"/>
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	
	<link href="/favicon.ico" mce_href="favicon.ico" rel="bookmark" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="icon" type="image/x-icon" /> 
	<link href="/favicon.ico" mce_href="favicon.ico" rel="shortcut icon" type="image/x-icon" /> 
	<!-- Canonical -->
	<link rel="canonical" href="http://cyan24.github.io/blog/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E4%B8%8A%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E4%B8%8E%E6%80%BB%E7%BB%93-3/">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Cyan的技术笔记" href="http://cyan24.github.io/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	

	<!-- Google Analytics -->
	

	<script type="text/javascript">
    var host = "cyan24.com";
    if ((host == window.location.host) && (window.location.protocol != "https:"))
        window.location.protocol = "https";
    </script>
    
</head>

	<body class="home blog et_pb_button_helper_class home-posts et_fixed_nav et_show_nav et_cover_background et_pb_gutter windows et_pb_gutters3 et_primary_nav_dropdown_animation_fade et_secondary_nav_dropdown_animation_fade et_pb_footer_columns4 et_header_style_left et_right_sidebar chrome">
		<div id="page-container">
    		<header id="main-header" data-height-onload="66">
	<div class="container clearfix et_menu_container">
		<div class="logo_container">
			<span class="logo_helper"></span>
			<a href="/">
				<!--img src="http://blog.ibireme.com/wp-content/uploads/2015/05/logo1.png" alt="Garan no dou" id="logo" data-height-percentage="54" /-->
				Cyan的技术笔记
			</a>
		</div>
		<div id="et-top-navigation" data-height="66" data-fixed-height="40">
			<nav id="top-menu-nav">
				<ul id="top-menu" class="nav">
					<li>
						<a class="page-link" href="/">
							首页
						</a>
					</li>
					
					
					
					
					<li>
						<a class="page-link" href="/About/">
							关于我
						</a>
					</li>
					
					
					
					<li>
						<a class="page-link" href="/Archives/">
							所有文章
						</a>
					</li>
					
					
					
					
					
					<li>
						<a class="page-link" href="/Design/">
							设计
						</a>
					</li>
					
					
					
					
					
					
					
					
					
					
					
					
					
					<li>
						<a class="page-link" href="/iOS/">
							iOS开发
						</a>
					</li>
					
					
					
					
					
					
					
					<li>
						<a class="page-link" href="/Other/">
							其他
						</a>
					</li>
					
					
					
					
					
					
					
					
					
					
					
					
					
					
					<!-- Social icons from Font Awesome, if enabled -->
					<li>
						<a class="page-link" href="">Find Me</a>
						<ul class="children">












<li>
	<a href="https://github.com/cyan24" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>























<li>
	<a href="https://twitter.com/cyan24" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>







<li>
	<a href="mailto:chianzjcy@aliyun.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>
</ul>
					</li>
					
				</ul>
			</nav>

			<div id="et_mobile_nav_menu">
				<div class="mobile_nav closed">
					<span class="select_page"></span>
					<span class="mobile_menu_bar"></span>
				</div>
			</div>				
		</div> <!-- #et-top-navigation -->
	</div> <!-- .container -->
	<div class="et_search_outer">
		<div class="container et_search_form_container">
			<form role="search" method="get" class="et-search-form" action="http://cyan24.github.io">
			<input type="search" class="et-search-field" placeholder="搜索 &hellip;" value="" name="s" title="搜索：" /></form>
			<span class="et_close_search_field"></span>
		</div>
	</div>
</header> <!-- #main-header -->

    		<div id="et-main-area">
      			

	

	

<article >
  <header style="background-image: url('/')">

<!--article  >
  <div style="background-image: url('/')"/>
  <header style="background-image: url('https://source.unsplash.com/category/nature/2600x500')"-->
    <h1 class="title">移动端上前端开发的一些问题与总结（3）</h1>
    <p id="subtitletrans" class="subtitlecontainer">
    <a class="subtitle">2015年03月13日</a>
     | <a class="subtitle" href="/About/">cyan</a>
	 | <a class="subtitle">  <i class="fa fa-book"></i>: <a href="/前端/">前端</a></a> <a class="subtitle">  <i class="fa fa-tags"></i>: <a href="/tags/html5/">html5</a>, <a href="/tags/移动开发/">移动开发</a></a>
    </p>
  </header>
  <section class="post-content">
  <h3>关于ios系统中，webapp启动图片在不同设备上的适应性设置</h3>

<p><a href="http://stackoverflow.com/questions/4687698/mulitple-apple-touch-startup-image-resolutions-for-ios-web-app-esp-for-ipad/10011893#10011893">不同设备上的适应性设置</a></p>

<hr>

<h3>关于ios系统中，中文输入法输入英文时，字母之间可能会出现一个六分之一空格</h3>

<p>可以通过正则去掉</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\u2006/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</code></pre></div>
<hr>

<h3>关于android webview中，input元素输入时出现的怪异情况</h3>

<p>见图:</p>

<p><img src="/img/post/15030131.jpg" alt=""> </p>

<p>Android web视图,至少在HTC EVO和三星的Galaxy Nexus中，文本输入框在输入时表现的就像占位符。情况为一个类似水印的东西在用户输入区域，一旦用户开始输入便会消失(见图片)。 在android的默认样式下当输入框获得焦点后,若存在一个绝对定位或者fixed的元素，布局会被破坏,其他元素与系统输入字段会发生重叠(如搜索图标将消失为搜索字段),可以观察到布局与原始输入字段有偏差(见截图)。 这是一个相当复杂的问题，以下简单布局可以重现这个问题:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;phone&quot;</span><span class="nt">&gt;</span>Phone: *<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;tel&quot;</span> <span class="na">name=</span><span class="s">&quot;phone&quot;</span> <span class="na">id=</span><span class="s">&quot;phone&quot;</span> <span class="na">minlength=</span><span class="s">&quot;10&quot;</span> <span class="na">maxlength=</span><span class="s">&quot;10&quot;</span> <span class="na">inputmode=</span><span class="s">&quot;latin digits&quot;</span> <span class="na">required=</span><span class="s">&quot;required&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div>
<p>解决方法</p>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">-webkit-user-modify</span><span class="o">:</span> <span class="nt">read-write-plaintext-only</span>
</code></pre></div>
<p>详细参考<a href="http://www.bielousov.com/2012/android-label-text-appears-in-input-field-as-a-placeholder/">[Android]: Input Field Issues</a></p>

<p>注意，该属性会导致中文不能输入词组，只能单个字。感谢鬼哥与飞（游勇飞）贡献此问题与解决方案</p>

<p>另外，在position:fixed后的元素里，尽量不要使用输入框。##更多的bug可参考(移动端web页面应用position:fixed题目总结)[http://www.cosdiv.com/page/M0/S882/882353.html]##</p>

<p>依旧无法解决（摩托罗拉ME863手机），则使用input:text类型而非password类型，并设置其设置 -webkit-text-security: disc; 隐藏输入密码从而解决。</p>

<hr>

<h3>ios6跟iphone5的那些事</h3>

<p>ip5的媒体查询</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">media</span> <span class="p">(</span><span class="nx">device</span><span class="o">-</span><span class="nx">height</span><span class="o">:</span> <span class="mi">568</span><span class="nx">px</span><span class="p">)</span> <span class="nx">and</span> <span class="p">(</span><span class="o">-</span><span class="nx">webkit</span><span class="o">-</span><span class="nx">min</span><span class="o">-</span><span class="nx">device</span><span class="o">-</span><span class="nx">pixel</span><span class="o">-</span><span class="nx">ratio</span><span class="o">:</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span><span class="cm">/* iPhone 5 or iPod Touch 5th generation */</span><span class="p">}</span>
</code></pre></div>
<p>使用媒体查询，提供不同的启动图片：</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;startup-568h.png&quot;</span> <span class="na">rel=</span><span class="s">&quot;apple-touch-startup-image&quot;</span> <span class="na">media=</span><span class="s">&quot;(device-height: 568px)&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;startup.png&quot;</span> <span class="na">rel=</span><span class="s">&quot;apple-touch-startup-image&quot;</span> <span class="na">sizes=</span><span class="s">&quot;640x920&quot;</span> <span class="na">media=</span><span class="s">&quot;(device-height: 480px)&quot;</span><span class="nt">&gt;</span>
　　 拍照上传


<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">file</span> <span class="na">accept=</span><span class="s">&quot;video/*&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">file</span> <span class="na">accept=</span><span class="s">&quot;image/*&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>不支持其他类型的文件 ，如音频，Pages文档或PDF文件。 也没有getUserMedia摄像头的实时流媒体支持。</p>

<p>可以使用的html5高级api: multipart POST表单提交上传 XMLHttpRequest 2 AJAX上传（甚至进度支持） 文件API ，在iOS 6允许JavaScript直接读取的字节数和客户端操作文件。</p>

<p>智能应用程序横幅</p>

<p>有了智能应用程序横幅，当网站上有一个相关联的本机应用程序时，Safari浏览器可以显示一个横幅。 如果用户没有安装这个应用程序将显示“安装”按钮，或已经安装的显示“查看”按钮可打开它。</p>

<p>在iTunes Link Maker搜索我们的应用程序和应用程序ID。</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;apple-itunes-app&quot;</span> <span class="na">content=</span><span class="s">&quot;app-id=9999999&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>可以使用 app-argument 提供字符串值，如果参加iTunes联盟计划，可以添加元标记数据</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;apple-itunes-app&quot;</span> <span class="na">content=</span><span class="s">&quot;app-id=9999999, app-argument=xxxxxx&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;apple-itunes-app&quot;</span> <span class="na">content=</span><span class="s">&quot;app-id=9999999, app-argument=xxxxxx, affiliate-data=partnerId=99&amp;siteID=XXXX&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>横幅需要156像素（设备是312 hi-dpi）在顶部，直到用户在下方点击内容或关闭按钮，你的网站才会展现全部的高度。 它就像HTML的DOM对象，但它不是一个真正的DOM。</p>

<p>CSS 3滤镜</p>
<div class="highlight"><pre><code class="language-html" data-lang="html">-webkit-filter: blur(5px) grayscale (.5) opacity(0.66) hue-rotate(100deg);
</code></pre></div>
<hr>

<h3>Cache开启和设置</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">browser</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">().</span><span class="nx">setAppCacheEnabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">().</span><span class="nx">setAppCachePath</span><span class="p">(</span><span class="s2">&quot;/data/data/[com.packagename]/cache&quot;</span><span class="p">);</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">().</span><span class="nx">setAppCacheMaxSize</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">);</span> <span class="c1">// 5MB</span>
</code></pre></div>
<hr>

<h3>LocalStorage相关设置</h3>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">browser</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setDatabaseEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">browser</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setDomStorageEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">String</span> <span class="n">databasePath</span> <span class="o">=</span> <span class="n">browser</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getDir</span><span class="o">(</span><span class="s">&quot;databases&quot;</span><span class="o">,</span> <span class="n">Context</span><span class="o">.</span><span class="na">MODE_PRIVATE</span><span class="o">).</span><span class="na">getPath</span><span class="o">();</span>
<span class="n">browser</span><span class="o">.</span><span class="na">getSettings</span><span class="o">().</span><span class="na">setDatabasePath</span><span class="o">(</span><span class="n">databasePath</span><span class="o">);</span><span class="c1">//Android　webview的LocalStorage有个问题，关闭APP或者重启后，就清楚了，所以需要browser.getSettings().setDatabase相关的操作，把LocalStoarge存到DB中</span>

<span class="n">myWebView</span><span class="o">.</span><span class="na">setWebChromeClient</span><span class="o">(</span><span class="k">new</span> <span class="nf">WebChromeClient</span><span class="o">(){</span>
　　　<span class="nd">@Override</span>
　　　<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onExceededDatabaseQuota</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">databaseIdentifier</span><span class="o">,</span> <span class="kt">long</span> <span class="n">currentQuota</span><span class="o">,</span> <span class="kt">long</span> <span class="n">estimatedSize</span><span class="o">,</span> <span class="kt">long</span> <span class="n">totalUsedQuota</span><span class="o">,</span> <span class="n">WebStorage</span><span class="o">.</span><span class="na">QuotaUpdater</span> <span class="n">quotaUpdater</span><span class="o">){</span>
　　　　　　　<span class="n">quotaUpdater</span><span class="o">.</span><span class="na">updateQuota</span><span class="o">(</span><span class="n">estimatedSize</span> <span class="o">*</span> <span class="mi">2</span><span class="o">);</span>
　　　<span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<hr>

<h3>浏览器自带缩放按钮取消显示</h3>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">browser</span><span class="p">.</span><span class="nx">getSettings</span><span class="p">().</span><span class="nx">setBuiltInZoomControls</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</code></pre></div>
<hr>

<h3>几个比较好的实践</h3>

<p>使用localstorage缓存html</p>

<p>使用lazyload，还要记得lazyload占位图虽然小，但是最好能提前加载到缓存</p>

<p>延时加载执行js</p>

<p>主要原因就在于Android Webview的onPageFinished事件，Android端一般是用这个事件来标识页面加载完成并显示的，也就是说在此之前，会一直loading，但是Android的OnPageFinished事件会在Javascript脚本执行完成之后才会触发。如果在页面中使用JQuery，会在处理完DOM对象，执行完$(document).ready(function() {});事件自会后才会渲染并显示页面。</p>

<hr>

<h3>移动浏览器篇</h3>

<p>[UC浏览器]video标签脱离文档流
场景：标签的父元素(祖辈元素)设置transform样式后，标签会脱离文档流。</p>

<p>测试环境：UC浏览器 8.7/8.6 + Android 2.3/4.0 。</p>

<p>Demo：<a href="http://maplejan.sinaapp.com/demo/uc_fixed.html">http://t.cn/zj3xiyu</a></p>

<p>解决方案：不使用transform属性。translate用top、margin等属性替代。</p>

<p>UC浏览器]video标签总在最前</p>

<p>场景：<video> 标签总是在最前（可以理解为video标签的z-index属性是Max）。</p>

<p>测试环境：UC浏览器 8.7/8.6 + Android 2.3/4.0 。</p>

<p>[UC浏览器]position:fixed 属性在UC浏览器的奇葩现象</p>

<p>场景：设置了position: fixed 的元素会遮挡z-index值更高的同辈元素。</p>

<p>在8.6的版本,这个情况直接出现。</p>

<p>在8.7之后的版本,当同辈元素的height大于713这个「神奇」的数值时,才会被遮挡。</p>

<p>测试环境：UC浏览器 8.8_beta/8.7/8.6 + Android 2.3/4.0 。</p>

<p>Demo：<a href="http://maplejan.sinaapp.com/demo/uc_fixed.html">http://t.cn/zYLTSg6</a></p>

<p>[QQ手机浏览器]不支持HttpOnly</p>

<p>场景：带有HttpOnly属性的Cookie，在QQ手机浏览器版本从4.0开始失效。JavaScript可以直接读取设置了HttpOnly的Cookie值。</p>

<p>测试环境：QQ手机浏览器 4.0/4.1/4.2 + Android 4.0 。</p>

<p>[MIUI原生浏览器]浏览器地址栏hash不改变</p>

<p>场景：location.hash 被赋值后，地址栏的地址不会改变。</p>

<p>但实际上 location.href 已经更新了，通过JavaScript可以顺利获取到更新后的地址。</p>

<p>虽然不影响正常访问，但用户无法将访问过程中改变hash后的地址存为书签。</p>

<p>测试环境：MIUI 4.0</p>

<p>[Chrome Mobile]fixed元素无法点击</p>

<p>场景：父元素设置position: fixed;</p>

<p>子元素设置position: absolute;</p>

<p>此时，如果父元素/子元素还设置了overflow: hidden 则出现“父元素遮挡该子元素“的bug。</p>

<p>视觉(view)层并没有出现遮挡，只是无法触发绑定在该子元素上的事件。可理解为：「看到点不到」。</p>

<p>补充： 页面往下滚动，触发position: fixed;的特性时，才会出现这个bug，在最顶不会出现。</p>

<p>测试平台： 小米1S，Android4.0的Chrome18</p>

<p>demo： <a href="http://maplejan.sinaapp.com/demo/fixed_chromemobile.html">http://maplejan.sinaapp.com/demo/fixed_chromemobile.html</a></p>

<p>解决办法： 把父元素和子元素的overflow: hidden去掉。</p>

<p>以上来源于 http://www.cnblogs.com/maplejan/archive/2013/04/26/3045928.html</p>

<p>[微信浏览器]</p>

<p>因为微信浏览器屏蔽了一部分链接图片，所以需要引导用户去打开新页面，可以用以下方式判断微信浏览器的ua</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">is_weixn</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">ua</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">ua</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/MicroMessenger/i</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;micromessenger&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>后端判断也很简单，比如php</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">function is_weixin(){ if ( strpos($_SERVER[&#39;HTTP_USER_AGENT&#39;], &#39;MicroMessenger&#39;) !== false ) { return true; } return false;}</span>
</code></pre></div>
<hr>

<h3>库的使用实践</h3>

<p>zepto.js</p>

<p><a href="http://chaoskeh.com/blog/some-experience-of-using-zepto.html">zepto的一篇使用注意点讲解</a></p>

<p><a href="http://blog.youyo.name/archives/zepto-tap-click-through-research.html">zepto的著名的tap“点透”bug</a></p>

<p><a href="http://www.cnblogs.com/sky000/archive/2013/03/29/2988952.html">zepto源码注释</a></p>

<hr>

<h3>跨域问题</h3>

<p>手机浏览器也是浏览器，在ajax调用外部api的时候也存在跨域问题。当然利用phonegap打包后，由于协议不一样就不存在跨域问题了。 但页面通常是需要跟后端进行调试的。一般会报类似</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">XMLHttpRequest</span> <span class="nx">cannot</span> <span class="nx">load</span> <span class="nx">XXX</span>
<span class="nx">Origin</span> <span class="kc">null</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">allowed</span> <span class="nx">by</span> <span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Allow</span><span class="o">-</span><span class="nx">Origin</span><span class="p">.</span>
</code></pre></div>
<p>以及</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">XMLHttpRequest</span> <span class="nx">cannot</span> <span class="nx">load</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//. Request header field Content-Type is not allowed by Access-Control-Allow-Headers.&quot;</span>
</code></pre></div>
<p>这时候可以让后端加上两个http头</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Allow</span><span class="o">-</span><span class="nx">Origin</span> <span class="s2">&quot;*&quot;</span>
<span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Allow</span><span class="o">-</span><span class="nx">Headers</span> <span class="s2">&quot;Origin, X-Requested-With, Content-Type, Accept&quot;</span>
</code></pre></div>
<p>第一个头可以避免跨域问题，第二个头可以方便ajax请求设置content-type等配置项</p>

<hr>

<h3>调试篇</h3>

<p>手机抓包与配host</p>

<p>在PC上，我们可以很方便地配host，但是手机上如何配host，这是一个问题。</p>

<p>这里主要使用fiddler和远程代理，实现手机配host的操作，具体操作如下：</p>

<p>首先，保证PC和移动设备在同一个局域网下；</p>

<p>PC上开启fiddler，并在设置中勾选“allow remote computers to connect”</p>

<p>首先，保证PC和移动设备在同一个局域网下；</p>

<p>PC上开启fiddler，并在设置中勾选“allow remote computers to connect”</p>

<p>手机上设置代理，代理IP为PC的IP地址，端口为8888（这是fiddler的默认端口）。通常手机上可以直接设置代理，如果没有，可以去下载一个叫ProxyDroid的APP来实现代理的设置。</p>

<p>此时你会发现，用手机上网，走的其实是PC上的fiddler，所有的请求包都会在fiddler中列出来，配合willow使用，即可实现配host，甚至是反向代理的操作。</p>

<hr>

<h3>相关收藏</h3>

<p><a href="https://github.com/AlloyTeam/Mars">腾讯移动Web前端知识库</a></p>

<hr>

<p>一些非常重要的工具类网站</p>

<p><a href="http://ww1.sinaimg.cn/bmiddle/c2c57f68jw1e4fh7dmw12j20fi2w6qe1.jpg">移动端手势表</a></p>

<p><a href="http://ued.ctrip.com/webkitcss/index.html">webkit独有的样式分析</a></p>

  </section>
  
</article>

<!-- Post navigation -->


<!-- Disqus -->


    		</div> <!-- #et-main-area -->
		</div> <!-- #page-container -->
		
<script src="/js/katex_init.js"></script>



<footer id="page-footer-trans" class="page-footer">
	<!--<p class="text"><a href="https://cyan24.github.io">Cyan的技术笔记</a> 
</p>-->
	Copyright &copy; 2016 <a href="https://cyan24.github.io">Cyan的技术笔记</a> 
 All Rights Reserved. 
	<p class="text">Hosted by <a href="https://github.com">GitHub</a><a alt="Fork me on GitHub" href="https://github.com/cyan24">Fork me on GitHub</a></p>
</footer>


    
<!-- WP Audio player plugin v1.9.3 - https://www.tipsandtricks-hq.com/wordpress-audio-music-player-plugin-4556/ -->
    <script type="text/javascript">
        soundManager.useFlashBlock = true; // optional - if used, required flashblock.css
        soundManager.url = '/plugins/soundmanager2.swf';
        function play_mp3(flg, ids, mp3url, volume, loops)
        {
            //Check the file URL parameter value
            var pieces = mp3url.split("|");
            if (pieces.length > 1) {//We have got an .ogg file too
                mp3file = pieces[0];
                oggfile = pieces[1];
                //set the file URL to be an array with the mp3 and ogg file
                mp3url = new Array(mp3file, oggfile);
            }

            soundManager.createSound({
                id: 'btnplay_' + ids,
                volume: volume,
                url: mp3url
            });

            if (flg == 'play') {
                    soundManager.play('btnplay_' + ids, {
                    onfinish: function() {
                        if (loops == 'true') {
                            loopSound('btnplay_' + ids);
                        }
                        else {
                            document.getElementById('btnplay_' + ids).style.display = 'inline';
                            document.getElementById('btnstop_' + ids).style.display = 'none';
                        }
                    }
                });
            }
            else if (flg == 'stop') {
    //soundManager.stop('btnplay_'+ids);
                soundManager.pause('btnplay_' + ids);
            }
        }
        function show_hide(flag, ids)
        {
            if (flag == 'play') {
                document.getElementById('btnplay_' + ids).style.display = 'none';
                document.getElementById('btnstop_' + ids).style.display = 'inline';
            }
            else if (flag == 'stop') {
                document.getElementById('btnplay_' + ids).style.display = 'inline';
                document.getElementById('btnstop_' + ids).style.display = 'none';
            }
        }
        function loopSound(soundID)
        {
            window.setTimeout(function() {
                soundManager.play(soundID, {onfinish: function() {
                        loopSound(soundID);
                    }});
            }, 1);
        }
        function stop_all_tracks()
        {
            soundManager.stopAll();
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].id.indexOf("btnplay_") == 0) {
                    inputs[i].style.display = 'inline';//Toggle the play button
                }
                if (inputs[i].id.indexOf("btnstop_") == 0) {
                    inputs[i].style.display = 'none';//Hide the stop button
                }
            }
        }
    </script>
    <script type='text/javascript' src="/js/frontend-builder-global-functions.js"></script>
<script type='text/javascript' src="/js/custom.js"></script>
<script type='text/javascript' src="/js/jquery.fitvids.js"></script>
<script type='text/javascript' src="/js/waypoints.min.js"></script>
<script type='text/javascript' src="/js/jquery.magnific-popup.js"></script>
<script type='text/javascript'>
/* <![CDATA[ */
var et_custom = {"ajaxurl":"http:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/images","builder_images_uri":"http:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/includes\/builder\/images","et_load_nonce":"ae39988568","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","fill":"Fill","field":"field","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"\u4e0a\u4e00\u9875","next":"\u4e0b\u4e00\u9875","is_builder_plugin_used":""};
/* ]]> */
</script>
<script type='text/javascript' src="/js/frontend-builder-scripts.js"></script>
  </body>
</html>
